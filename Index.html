<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ 2025 | Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        :root { 
            --wa-green: #25D366; 
            --wa-dark: #075E54; 
            --error: #e74c3c; 
            --success: #2ecc71; 
            --primary: #3498db;
            --warning: #f1c40f;
            --gray: #95a5a6;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #f0f2f5 0%, #dfe6e9 100%);
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center;
            min-height: 100vh;
        }
        
        .app-container { 
            background: white; 
            width: 100%; 
            max-width: 650px; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            margin: auto;
        }
        
        h2 { 
            text-align: center; 
            color: var(--wa-dark); 
            border-bottom: 3px solid var(--wa-green); 
            padding-bottom: 15px; 
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .box { 
            background: #f8f9fa; 
            border: 2px solid #e9ecef; 
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            transition: border-color 0.3s;
        }
        
        .box:hover {
            border-color: var(--primary);
        }
        
        label { 
            display: block; 
            font-weight: bold; 
            margin-bottom: 12px; 
            color: #2c3e50;
            font-size: 16px;
        }
        
        textarea, input { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            box-sizing: border-box; 
            font-size: 15px; 
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px; 
            transition: all 0.3s; 
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-gps { 
            background: var(--primary); 
            color: white; 
        }
        
        .btn-gps:hover {
            background: #2980b9;
        }
        
        .btn-send { 
            background: var(--wa-green); 
            color: white; 
        }
        
        .btn-send:hover {
            background: #1da851;
        }
        
        .btn-next { 
            background: var(--warning); 
            color: #333; 
            display: none; 
        }
        
        .btn-next:hover {
            background: #f39c12;
        }
        
        .btn-save {
            background: var(--gray);
            color: white;
        }
        
        .btn-save:hover {
            background: #7f8c8d;
        }
        
        #statusLog { 
            font-size: 15px; 
            text-align: center; 
            margin: 15px 0; 
            font-weight: bold;
            padding: 12px;
            border-radius: 8px;
            background: #f8f9fa;
            min-height: 24px;
        }
        
        .alert { 
            padding: 15px; 
            border-radius: 10px; 
            font-size: 14px; 
            margin-bottom: 20px; 
            line-height: 1.6;
            border-right: 5px solid;
        }
        
        .alert-warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffeeba;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar { 
            width: 100%; 
            height: 12px; 
            background: #e0e0e0; 
            border-radius: 6px; 
            overflow: hidden; 
            margin-bottom: 10px;
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--wa-green), var(--primary));
            width: 0%; 
            transition: width 0.5s ease;
            border-radius: 6px;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: var(--wa-dark);
            font-size: 15px;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .app-container {
                padding: 20px;
                border-radius: 15px;
            }
            
            .box {
                padding: 15px;
            }
            
            .btn {
                padding: 14px;
                font-size: 15px;
            }
            
            h2 {
                font-size: 20px;
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .app-container {
                padding: 15px;
            }
            
            textarea, input {
                padding: 12px;
                font-size: 14px;
            }
            
            .btn {
                padding: 12px;
                font-size: 14px;
            }
        }
        
        /* Ø±Ø³ÙˆÙ…ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .icon {
            font-size: 20px;
        }
        
        .counter {
            display: inline-block;
            background: var(--wa-dark);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .input-with-icon input {
            padding-right: 40px;
        }
        
        .input-icon {
            position: absolute;
            right: 15px;
            color: var(--gray);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .message-preview {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>

<div class="app-container">
    <h2><span class="icon">ğŸš€</span> Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© 2025)</h2>

    <div class="alert alert-warning">
        <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯:</strong><br><br>
        1. <strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS):</strong> Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ Ø§Ù„Ù€ GPS Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©. ÙŠÙØ¶Ù„ Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¶Ø§ÙØ© Ø£Ùˆ ÙØªØ­Ù‡ Ø¹Ø¨Ø± Live Server.<br>
        2. <strong>Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©:</strong> ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.<br>
        3. <strong>HTTPS:</strong> ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¶Ø§ÙØ© HTTPS Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù€ GPS.
    </div>

    <div class="box">
        <label>1. Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©: <span id="messageCounter" class="counter">0</span></label>
        <textarea id="mainMessage" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." oninput="updateMessageCounter()"></textarea>
        
        <div class="stats">
            <span id="charCount">0 Ø­Ø±Ù</span>
            <span id="wordCount">0 ÙƒÙ„Ù…Ø©</span>
        </div>
        
        <button class="btn btn-gps" onclick="addCurrentLocation()">
            <span class="icon">ğŸ“</span> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)
        </button>
        
        <div class="input-with-icon" style="margin-top: 15px;">
            <input type="text" id="fileUrl" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ Ø³Ø­Ø§Ø¨ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <span class="input-icon">ğŸ”—</span>
        </div>
        
        <button class="btn" style="background: #9b59b6; color: white; margin-top: 10px;" onclick="showPreview()">
            <span class="icon">ğŸ‘ï¸</span> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        </button>
        
        <div id="messagePreview" class="message-preview"></div>
    </div>

    <div class="box">
        <label>2. Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: <span id="numbersCounter" class="counter">0</span></label>
        <textarea id="phoneNumbers" rows="5" placeholder="Ø¶Ø¹ ÙƒÙ„ Ø±Ù‚Ù… ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: +9665xxxxxxxx Ø£Ùˆ 9665xxxxxxxx)" oninput="validateAndCountNumbers()"></textarea>
        
        <div class="stats">
            <span id="validNumbers">0 Ø±Ù‚Ù… ØµØ§Ù„Ø­</span>
            <span id="invalidNumbers">0 Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
    </div>

    <div id="statusLog">ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…</div>
    
    <button class="btn btn-send" id="startBtn" onclick="startCampaign()">
        <span class="icon">ğŸš€</span> Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
    </button>
    
    <button class="btn btn-next" id="nextBtn" onclick="processNext()">
        <span class="icon">â¡ï¸</span> Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ
    </button>
    
    <button class="btn btn-save" onclick="saveData()">
        <span class="icon">ğŸ’¾</span> Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
    </button>
    
    <button class="btn" style="background: #e74c3c; color: white; margin-top: 10px;" onclick="resetAll()">
        <span class="icon">ğŸ”„</span> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„
    </button>
</div>

<script>
    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    let contacts = [];
    let currentIdx = 0;
    let totalContacts = 0;
    let originalNumbers = [];

    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = () => {
        document.getElementById('mainMessage').value = localStorage.getItem('z_msg') || '';
        document.getElementById('phoneNumbers').value = localStorage.getItem('z_nums') || '';
        document.getElementById('fileUrl').value = localStorage.getItem('z_file') || '';
        
        updateMessageCounter();
        validateAndCountNumbers();
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± ØªØ­Ù…ÙŠÙ„ Ù„Ø·ÙŠÙ
        setTimeout(() => {
            document.getElementById('statusLog').innerHTML = "âœ¨ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­!";
        }, 500);
    };

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
    function saveData() {
        const message = document.getElementById('mainMessage').value;
        const numbers = document.getElementById('phoneNumbers').value;
        const fileUrl = document.getElementById('fileUrl').value;
        
        localStorage.setItem('z_msg', message);
        localStorage.setItem('z_nums', numbers);
        localStorage.setItem('z_file', fileUrl);
        
        document.getElementById('statusLog').innerHTML = "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©";
        
        // ØªØ£Ø«ÙŠØ± Ù†Ø¬Ø§Ø­
        const log = document.getElementById('statusLog');
        log.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
        log.style.color = '#155724';
        log.style.border = '2px solid #c3e6cb';
        
        setTimeout(() => {
            log.style.background = '#f8f9fa';
            log.style.color = '';
            log.style.border = '';
        }, 2000);
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function updateMessageCounter() {
        const message = document.getElementById('mainMessage').value;
        const chars = message.length;
        const words = message.trim() ? message.trim().split(/\s+/).length : 0;
        
        document.getElementById('messageCounter').textContent = chars;
        document.getElementById('charCount').textContent = `${chars} Ø­Ø±Ù`;
        document.getElementById('wordCount').textContent = `${words} ÙƒÙ„Ù…Ø©`;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ¹Ø¯Ù‡Ø§
    function validateAndCountNumbers() {
        const numbersText = document.getElementById('phoneNumbers').value;
        const numbersArray = numbersText.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        document.getElementById('numbersCounter').textContent = numbersArray.length;
        
        let validCount = 0;
        let invalidCount = 0;
        
        originalNumbers = numbersArray;
        
        numbersArray.forEach(num => {
            if (isValidPhoneNumber(num)) {
                validCount++;
            } else {
                invalidCount++;
            }
        });
        
        document.getElementById('validNumbers').textContent = `${validCount} Ø±Ù‚Ù… ØµØ§Ù„Ø­`;
        document.getElementById('invalidNumbers').textContent = `${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­`;
        
        // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµØ­Ø©
        const counter = document.getElementById('numbersCounter');
        if (invalidCount > 0) {
            counter.style.background = 'var(--error)';
        } else {
            counter.style.background = 'var(--success)';
        }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    function isValidPhoneNumber(phone) {
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù…
        const cleanNum = phone.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
        
        // Ø£Ù†Ù…Ø§Ø· Ù…Ù‚Ø¨ÙˆÙ„Ø©
        const patterns = [
            /^\+[1-9]\d{10,14}$/,        // +9665xxxxxxxx
            /^00[1-9]\d{10,14}$/,        // 009665xxxxxxxx
            /^[1-9]\d{9,14}$/            // 9665xxxxxxxx Ø£Ùˆ 5xxxxxxxx
        ];
        
        return patterns.some(pattern => pattern.test(cleanNum));
    }

    // ØªÙ†Ø¸ÙŠÙ ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    function cleanPhoneNumbers(numbers) {
        return numbers.map(num => {
            let cleanNum = num.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
            
            // ØªØ­ÙˆÙŠÙ„ 00 Ø¥Ù„Ù‰ +
            if (cleanNum.startsWith('00')) {
                cleanNum = '+' + cleanNum.substring(2);
            }
            
            // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø¨Ù€ 966 Ø¨Ø¯ÙˆÙ† + Ø£Ùˆ 00
            if (cleanNum.startsWith('966') && !cleanNum.startsWith('+')) {
                cleanNum = '+' + cleanNum;
            }
            
            // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø¨Ø±Ù‚Ù… Ù…Ø­Ù„ÙŠ Ø³Ø¹ÙˆØ¯ÙŠ Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­
            if (/^5\d{8}$/.test(cleanNum)) {
                cleanNum = '+966' + cleanNum;
            }
            
            return cleanNum;
        }).filter(isValidPhoneNumber);
    }

    // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù€ GPS Ø§Ù„Ù…Ø­Ø³Ù†Ø© ---
    function addCurrentLocation() {
        const log = document.getElementById('statusLog');
        
        if (!navigator.geolocation) {
            alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.");
            return;
        }

        log.innerHTML = "ğŸ›°ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©...";
        log.style.color = '#3498db';

        const options = {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        };

        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude.toFixed(6);
                const lng = position.coords.longitude.toFixed(6);
                const accuracy = Math.round(position.coords.accuracy);
                
                // Ø±ÙˆØ§Ø¨Ø· Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹
                const googleMapsLink = `https://maps.google.com/?q=${lat},${lng}`;
                const openStreetMapLink = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}`;
                
                const locationText = `ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:\nØ¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${accuracy} Ù…ØªØ±\n\nØ®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„:\n${googleMapsLink}\n\nOpenStreetMap:\n${openStreetMapLink}`;
                
                const textarea = document.getElementById('mainMessage');
                if (textarea.value && !textarea.value.endsWith('\n')) {
                    textarea.value += '\n\n';
                }
                textarea.value += locationText;
                
                log.innerHTML = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø±Ø³Ø§Ù„Ø©";
                log.style.color = 'var(--success)';
                
                updateMessageCounter();
                showPreview();
            },
            (error) => {
                const errorMessages = {
                    1: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹',
                    2: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©',
                    3: 'Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'
                };
                
                const errorMsg = errorMessages[error.code] || error.message;
                log.innerHTML = `âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${errorMsg}`;
                log.style.color = 'var(--error)';
                
                alert(`ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:\n${errorMsg}\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. ØªÙØ¹ÙŠÙ„ GPS\n2. Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹\n3. Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS`);
            },
            options
        );
    }

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function showPreview() {
        const message = document.getElementById('mainMessage').value;
        const fileUrl = document.getElementById('fileUrl').value;
        const preview = document.getElementById('messagePreview');
        
        if (!message && !fileUrl) {
            preview.innerHTML = "<em style='color: #999;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</em>";
            preview.style.display = 'block';
            return;
        }
        
        let previewHTML = '';
        
        if (message) {
            previewHTML += `<div style="margin-bottom: 15px;"><strong>ğŸ“ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong></div>`;
            previewHTML += `<div style="white-space: pre-wrap; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">${message.replace(/\n/g, '<br>')}</div>`;
        }
        
        if (fileUrl) {
            previewHTML += `<div style="margin-bottom: 10px;"><strong>ğŸ”— Ø§Ù„Ù…Ø±ÙÙ‚:</strong></div>`;
            previewHTML += `<div style="color: #3498db; word-break: break-all;">${fileUrl}</div>`;
        }
        
        preview.innerHTML = previewHTML;
        preview.style.display = 'block';
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            preview.style.opacity = '0';
            preview.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                preview.style.display = 'none';
                preview.style.opacity = '1';
            }, 500);
        }, 10000);
    }

    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
    function updateProgress() {
        const progress = totalContacts > 0 ? ((currentIdx / totalContacts) * 100) : 0;
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        progressFill.style.width = `${progress}%`;
        progressText.textContent = `${Math.round(progress)}% (${currentIdx} Ù…Ù† ${totalContacts})`;
    }

    // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ---
    function startCampaign() {
        const rawNums = document.getElementById('phoneNumbers').value;
        const numbersArray = rawNums.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        if (numbersArray.length === 0) {
            alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹.");
            return;
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        contacts = cleanPhoneNumbers(numbersArray);
        
        if (contacts.length === 0) {
            alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ØµØ§Ù„Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù….");
            return;
        }
        
        // ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± ØµØ§Ù„Ø­Ø©
        if (contacts.length < numbersArray.length) {
            const invalidCount = numbersArray.length - contacts.length;
            if (!confirm(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ ${contacts.length} Ø±Ù‚Ù… ØµØ§Ù„Ø­ ÙÙ‚Ø·ØŸ`)) {
                return;
            }
        }
        
        // ØªØ­Ø°ÙŠØ± Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±
        if (contacts.length > 50) {
            if (!confirm(`âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ØªØ±Ø³Ù„ ${contacts.length} Ø±Ø³Ø§Ù„Ø©.\nÙ‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø­Ø¸Ø± Ù…Ø¤Ù‚Øª Ù…Ù† WhatsApp.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) {
                return;
            }
        }
        
        // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        if (!confirm(`ğŸš€ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„!\n\nØ§Ù„Ø±Ø³Ø§Ø¦Ù„: ${contacts.length}\nØ³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù„ÙƒÙ„ Ø±Ù‚Ù….\nØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¢Ù†ØŸ`)) {
            return;
        }
        
        totalContacts = contacts.length;
        currentIdx = 0;
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('progressContainer').style.display = 'block';
        
        document.getElementById('statusLog').innerHTML = `ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ${totalContacts} Ø±Ù‚Ù…...`;
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        processNext();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ
    function processNext() {
        if (currentIdx >= totalContacts) {
            completeCampaign();
            return;
        }
        
        const phone = contacts[currentIdx];
        let finalMsg = document.getElementById('mainMessage').value;
        const fileLink = document.getElementById('fileUrl').value;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙÙ‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if (fileLink) {
            finalMsg += `\n\nğŸ”— Ø§Ù„Ù…Ø±ÙÙ‚: ${fileLink}`;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· WhatsApp
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        let whatsappUrl;
        if (isIOS) {
            whatsappUrl = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(finalMsg)}`;
        } else {
            whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(finalMsg)}`;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        document.getElementById('statusLog').innerHTML = 
            `ğŸ“¤ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ${currentIdx + 1} Ù…Ù† ${totalContacts}<br><small>${phone}</small>`;
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        updateProgress();
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© WhatsApp
        setTimeout(() => {
            const newWindow = window.open(whatsappUrl, '_blank', 'width=600,height=700');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                alert("âš ï¸ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©!\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.");
                return;
            }
        }, 500);
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¤Ø´Ø±
        currentIdx++;
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø£Ø®ÙŠØ±ØŒ Ø£Ø¹Ø¯ ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø± Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        if (currentIdx < totalContacts) {
            document.getElementById('nextBtn').innerHTML = `<span class="icon">â¡ï¸</span> Ø§Ù„ØªØ§Ù„ÙŠ (${currentIdx + 1} Ù…Ù† ${totalContacts})`;
        } else {
            document.getElementById('nextBtn').innerHTML = `<span class="icon">âœ…</span> Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„`;
        }
    }

    // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø©
    function completeCampaign() {
        document.getElementById('statusLog').innerHTML = 
            `ğŸ‰ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!<br><small>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${totalContacts} Ø±Ø³Ø§Ù„Ø©</small>`;
        
        document.getElementById('nextBtn').innerHTML = `<span class="icon">ğŸ”„</span> Ø¨Ø¯Ø¡ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©`;
        document.getElementById('nextBtn').onclick = () => location.reload();
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù„Ø§ÙƒØªÙ…Ø§Ù„
        document.getElementById('progressFill').style.background = 'var(--success)';
        document.getElementById('progressText').innerHTML = `âœ… Ø§ÙƒØªÙ…Ù„ 100%`;
        
        // Ø­ÙØ¸ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¥Ø±Ø³Ø§Ù„
        localStorage.setItem('z_last_send', new Date().toISOString());
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„
    function resetAll() {
        if (confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
            localStorage.clear();
            document.getElementById('mainMessage').value = '';
            document.getElementById('phoneNumbers').value = '';
            document.getElementById('fileUrl').value = '';
            
            contacts = [];
            currentIdx = 0;
            totalContacts = 0;
            
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            
            updateMessageCounter();
            validateAndCountNumbers();
            
            document.getElementById('statusLog').innerHTML = "ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­";
            
            setTimeout(() => {
                document.getElementById('statusLog').innerHTML = "ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…";
            }, 2000);
        }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    document.addEventListener('keydown', (e) => {
        // Ctrl + S Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            saveData();
        }
        
        // Ctrl + Enter Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            if (document.getElementById('startBtn').style.display !== 'none') {
                startCampaign();
            }
        }
        
        // F1 Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        if (e.key === 'F1') {
            e.preventDefault();
            alert(`ğŸ†˜ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­:\n\nCtrl+S: Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nCtrl+Enter: Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©\nF1: Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©\n\nØªÙ„Ù…ÙŠØ­: Ø§Ø¶ØºØ· "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©" Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ!`);
        }
    });

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
    setTimeout(() => {
        if (!localStorage.getItem('z_welcome_shown')) {
            alert("ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ 2025!\n\nØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø¹Ø¨Ø± WhatsApp\n\nÙ…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø©:\nâœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ\nâœ… Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…Ø§Ø¹ÙŠ Ù…ØªØ¹Ø¯Ø¯\nâœ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹\nâœ… ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ·ÙˆØ±Ø©\n\nØ§Ø¶ØºØ· F1 Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©!");
            localStorage.setItem('z_welcome_shown', 'true');
        }
    }, 1000);
</script>

</body>
</html>
