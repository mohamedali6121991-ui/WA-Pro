<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ - Ø¨ÙˆØ§Ø³Ø·Ø©: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ | Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        :root { 
            --wa-green: #25D366; 
            --wa-dark: #075E54; 
            --error: #e74c3c; 
            --success: #2ecc71; 
            --primary: #3498db;
            --warning: #f1c40f;
            --gray: #95a5a6;
            --purple: #9b59b6;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #f0f2f5 0%, #dfe6e9 100%);
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center;
            min-height: 100vh;
        }
        
        .app-container { 
            background: white; 
            width: 100%; 
            max-width: 700px; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            margin: auto;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .developer-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--wa-dark);
            font-weight: bold;
        }
        
        .dev-badge {
            background: linear-gradient(135deg, var(--primary), var(--purple));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .language-switcher {
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            padding: 8px 15px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .lang-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
        }
        
        h2 { 
            text-align: center; 
            color: var(--wa-dark); 
            border-bottom: 3px solid var(--wa-green); 
            padding-bottom: 15px; 
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .box { 
            background: #f8f9fa; 
            border: 2px solid #e9ecef; 
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            transition: border-color 0.3s;
        }
        
        .box:hover {
            border-color: var(--primary);
        }
        
        label { 
            display: block; 
            font-weight: bold; 
            margin-bottom: 12px; 
            color: #2c3e50;
            font-size: 16px;
        }
        
        textarea, input, select { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            box-sizing: border-box; 
            font-size: 15px; 
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px; 
            transition: all 0.3s; 
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-gps { 
            background: var(--primary); 
            color: white; 
        }
        
        .btn-gps:hover {
            background: #2980b9;
        }
        
        .btn-send { 
            background: var(--wa-green); 
            color: white; 
        }
        
        .btn-send:hover {
            background: #1da851;
        }
        
        .btn-next { 
            background: var(--warning); 
            color: #333; 
            display: none; 
        }
        
        .btn-next:hover {
            background: #f39c12;
        }
        
        .btn-save {
            background: var(--gray);
            color: white;
        }
        
        .btn-save:hover {
            background: #7f8c8d;
        }
        
        .btn-upload {
            background: var(--purple);
            color: white;
        }
        
        .btn-upload:hover {
            background: #8e44ad;
        }
        
        #statusLog { 
            font-size: 15px; 
            text-align: center; 
            margin: 15px 0; 
            font-weight: bold;
            padding: 12px;
            border-radius: 8px;
            background: #f8f9fa;
            min-height: 24px;
        }
        
        .alert { 
            padding: 15px; 
            border-radius: 10px; 
            font-size: 14px; 
            margin-bottom: 20px; 
            line-height: 1.6;
            border-right: 5px solid;
        }
        
        .alert-warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffeeba;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar { 
            width: 100%; 
            height: 12px; 
            background: #e0e0e0; 
            border-radius: 6px; 
            overflow: hidden; 
            margin-bottom: 10px;
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--wa-green), var(--primary));
            width: 0%; 
            transition: width 0.5s ease;
            border-radius: 6px;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: var(--wa-dark);
            font-size: 15px;
        }
        
        /* Ù‚Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
        .upload-section {
            border: 2px dashed var(--primary);
            padding: 20px;
            text-align: center;
            border-radius: 15px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-section:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: var(--purple);
        }
        
        .upload-section.dragover {
            background: rgba(155, 89, 182, 0.2);
            border-color: var(--purple);
            transform: scale(1.02);
        }
        
        .file-list {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-icon {
            font-size: 20px;
        }
        
        .file-name {
            font-weight: bold;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-size {
            color: #666;
            font-size: 12px;
        }
        
        .remove-file {
            color: var(--error);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
        }
        
        .upload-progress {
            width: 100%;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
            display: none;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .app-container {
                padding: 20px;
                border-radius: 15px;
            }
            
            .control-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .box {
                padding: 15px;
            }
            
            .btn {
                padding: 14px;
                font-size: 15px;
            }
            
            h2 {
                font-size: 20px;
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .app-container {
                padding: 15px;
            }
            
            textarea, input, select {
                padding: 12px;
                font-size: 14px;
            }
            
            .btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .file-name {
                max-width: 150px;
            }
        }
        
        /* Ø±Ø³ÙˆÙ…ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .icon {
            font-size: 20px;
        }
        
        .counter {
            display: inline-block;
            background: var(--wa-dark);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .input-with-icon input {
            padding-right: 40px;
        }
        
        .input-icon {
            position: absolute;
            right: 15px;
            color: var(--gray);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .message-preview {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
        [dir="ltr"] {
            text-align: left;
        }
        
        [dir="ltr"] .box {
            border-left: 2px solid #e9ecef;
            border-right: none;
        }
        
        [dir="ltr"] .alert {
            border-left: 5px solid;
            border-right: none;
        }
        
        [dir="ltr"] .file-item {
            border-right: 4px solid var(--primary);
            border-left: none;
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="control-bar">
        <div class="developer-info">
            <div class="dev-badge">ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±</div>
            <div class="dev-name" data-ar="Ø¨ÙˆØ§Ø³Ø·Ø©: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" data-en="By: Mohammed Ahmed">Ø¨ÙˆØ§Ø³Ø·Ø©: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</div>
        </div>
        
        <div class="language-switcher">
            <button class="lang-btn active" onclick="switchLanguage('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
            <button class="lang-btn" onclick="switchLanguage('en')">ğŸ‡ºğŸ‡¸ English</button>
        </div>
    </div>

    <h2>
        <span class="icon" data-ar="ğŸš€" data-en="ğŸš€">ğŸš€</span>
        <span data-ar="Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©)" data-en="Zajel Pro (Global Edition)">Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©)</span>
    </h2>

    <div class="alert alert-warning" id="alertBox">
        <strong data-ar="âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯:" data-en="âš ï¸ Important notes for proper operation:">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯:</strong><br><br>
        <span data-ar="1. Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS): Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ Ø§Ù„Ù€ GPS Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©. ÙŠÙØ¶Ù„ Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¶Ø§ÙØ© HTTPS." 
              data-en="1. Location (GPS): Browsers block GPS if you open the file directly. Better to upload it to HTTPS hosting.">1. Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS): Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ Ø§Ù„Ù€ GPS Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©. ÙŠÙØ¶Ù„ Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¶Ø§ÙØ© HTTPS.</span><br>
        <span data-ar="2. Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­." 
              data-en="2. Popups: You must allow popups in browser settings.">2. Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.</span><br>
        <span data-ar="3. Ø§Ù„Ù…Ù„ÙØ§Øª: ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·." 
              data-en="3. Files: You can upload files directly from your device for media sending support.">3. Ø§Ù„Ù…Ù„ÙØ§Øª: ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·.</span>
    </div>

    <div class="box">
        <label data-ar="1. Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:" data-en="1. Unified Message Text:">
            <span>1. Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:</span>
            <span id="messageCounter" class="counter">0</span>
        </label>
        <textarea id="mainMessage" rows="4" 
                  data-ar-placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." 
                  data-en-placeholder="Type your message here..."
                  oninput="updateMessageCounter()"></textarea>
        
        <div class="stats">
            <span id="charCount" data-ar="0 Ø­Ø±Ù" data-en="0 chars">0 Ø­Ø±Ù</span>
            <span id="wordCount" data-ar="0 ÙƒÙ„Ù…Ø©" data-en="0 words">0 ÙƒÙ„Ù…Ø©</span>
        </div>
        
        <button class="btn btn-gps" onclick="addCurrentLocation()">
            <span class="icon">ğŸ“</span>
            <span data-ar="Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)" data-en="Add My Current Location (GPS)">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)</span>
        </button>
        
        <!-- Ù‚Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
        <div class="upload-section" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="icon">ğŸ“</div>
            <div data-ar="Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±" 
                 data-en="Drag & drop files here or click to choose">
                Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                <span data-ar="(Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ PDFØŒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)" 
                      data-en="(Images, Videos, PDF, Documents)">
                    (Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ PDFØŒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)
                </span>
            </div>
            <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
        </div>
        
        <!-- Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ø±ÙØ¹ -->
        <div class="upload-progress" id="uploadProgress">
            <div class="upload-progress-bar" id="uploadProgressBar"></div>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© -->
        <div class="file-list" id="fileList"></div>
        
        <!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© -->
        <div class="input-with-icon" style="margin-top: 15px; display: none;" id="uploadedFilesContainer">
            <input type="text" id="uploadedFilesUrl" readonly 
                   data-ar-placeholder="Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹"
                   data-en-placeholder="Uploaded file links will appear here automatically">
            <span class="input-icon">ğŸ”—</span>
        </div>
        
        <!-- Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠ -->
        <div class="input-with-icon" style="margin-top: 15px;">
            <input type="text" id="manualFileUrl" 
                   data-ar-placeholder="Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù…Ù„Ù ÙŠØ¯ÙˆÙŠØ§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                   data-en-placeholder="Or enter file link manually (optional)">
            <span class="input-icon">ğŸŒ</span>
        </div>
        
        <button class="btn btn-upload" onclick="uploadFilesToCloud()" style="margin-top: 10px;">
            <span class="icon">â˜ï¸</span>
            <span data-ar="Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©" data-en="Upload Files to Cloud">Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</span>
        </button>
        
        <button class="btn" style="background: #1abc9c; color: white; margin-top: 10px;" onclick="showPreview()">
            <span class="icon">ğŸ‘ï¸</span>
            <span data-ar="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©" data-en="Preview Message">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</span>
        </button>
        
        <div id="messagePreview" class="message-preview"></div>
    </div>

    <div class="box">
        <label data-ar="2. Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:" data-en="2. WhatsApp Numbers List:">
            <span>2. Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</span>
            <span id="numbersCounter" class="counter">0</span>
        </label>
        <textarea id="phoneNumbers" rows="5" 
                  data-ar-placeholder="Ø¶Ø¹ ÙƒÙ„ Ø±Ù‚Ù… ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: +9665xxxxxxxx Ø£Ùˆ 9665xxxxxxxx)"
                  data-en-placeholder="Put each number on a new line (e.g., +9665xxxxxxxx or 9665xxxxxxxx)"
                  oninput="validateAndCountNumbers()"></textarea>
        
        <div class="stats">
            <span id="validNumbers" data-ar="0 Ø±Ù‚Ù… ØµØ§Ù„Ø­" data-en="0 valid numbers">0 Ø±Ù‚Ù… ØµØ§Ù„Ø­</span>
            <span id="invalidNumbers" data-ar="0 Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­" data-en="0 invalid numbers">0 Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
        
        <!-- Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© -->
        <div style="margin-top: 15px;">
            <label data-ar="Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:" data-en="Select default country code:">
                Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:
            </label>
            <select id="countryCode" onchange="updateCountryCode()">
                <option value="+966">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (+966)</option>
                <option value="+971">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª (+971)</option>
                <option value="+20">ğŸ‡ªğŸ‡¬ Ù…ØµØ± (+20)</option>
                <option value="+1">ğŸ‡ºğŸ‡¸ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© (+1)</option>
                <option value="+44">ğŸ‡¬ğŸ‡§ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø© (+44)</option>
                <option value="+971">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª (+971)</option>
                <option value="+962">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù† (+962)</option>
                <option value="+973">ğŸ‡§ğŸ‡­ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† (+973)</option>
                <option value="+974">ğŸ‡¶ğŸ‡¦ Ù‚Ø·Ø± (+974)</option>
                <option value="+968">ğŸ‡´ğŸ‡² Ø¹Ù…Ø§Ù† (+968)</option>
                <option value="+212">ğŸ‡²ğŸ‡¦ Ø§Ù„Ù…ØºØ±Ø¨ (+212)</option>
                <option value="+213">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± (+213)</option>
                <option value="custom">âœï¸ Ù…Ø®ØµØµ</option>
            </select>
            <input type="text" id="customCountryCode" placeholder="+xxx" style="display: none; margin-top: 10px;">
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
    </div>

    <div id="statusLog" data-ar="ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…" 
                      data-en="ğŸ“± Ready to start - Enter message and numbers">
        ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…
    </div>
    
    <button class="btn btn-send" id="startBtn" onclick="startCampaign()">
        <span class="icon">ğŸš€</span>
        <span data-ar="Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©" data-en="Start Mass Campaign">Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</span>
    </button>
    
    <button class="btn btn-next" id="nextBtn" onclick="processNext()">
        <span class="icon">â¡ï¸</span>
        <span data-ar="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ" data-en="Next Number">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ</span>
    </button>
    
    <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button class="btn btn-save" onclick="saveData()" style="flex: 1;">
            <span class="icon">ğŸ’¾</span>
            <span data-ar="Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©" data-en="Save Draft">Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©</span>
        </button>
        
        <button class="btn" style="background: #e74c3c; color: white; flex: 1;" onclick="resetAll()">
            <span class="icon">ğŸ”„</span>
            <span data-ar="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†" data-en="Reset All">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
        </button>
    </div>
</div>

<script>
    // ============== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ==============
    let contacts = [];
    let currentIdx = 0;
    let totalContacts = 0;
    let uploadedFiles = [];
    let currentLanguage = 'ar';
    
    // ============== Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==============
    window.onload = () => {
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„ØºØ©
        const savedLang = localStorage.getItem('z_language') || 'ar';
        switchLanguage(savedLang);
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        document.getElementById('mainMessage').value = localStorage.getItem('z_msg') || '';
        document.getElementById('phoneNumbers').value = localStorage.getItem('z_nums') || '';
        document.getElementById('manualFileUrl').value = localStorage.getItem('z_manual_file') || '';
        document.getElementById('countryCode').value = localStorage.getItem('z_country_code') || '+966';
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
        const savedFiles = localStorage.getItem('z_files');
        if (savedFiles) {
            uploadedFiles = JSON.parse(savedFiles);
            renderFileList();
        }
        
        updateMessageCounter();
        validateAndCountNumbers();
        updateCountryCode();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª
        setupFileDrop();
        
        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
        setTimeout(() => {
            if (!localStorage.getItem('z_welcome_shown')) {
                const msg = currentLanguage === 'ar' 
                    ? "ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©!\n\nØ¨ÙˆØ§Ø³Ø·Ø©: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯\n\nÙ…Ù…ÙŠØ²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©:\nâœ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©\nâœ… Ø¯Ø¹Ù… Ù„ØºØªÙŠÙ†\nâœ… Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø©\nâœ… ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø³Ù†Ø©"
                    : "ğŸ‰ Welcome to Zajel Pro Global Edition!\n\nBy: Mohammed Ahmed\n\nNew Features:\nâœ… Direct file upload\nâœ… Dual language support\nâœ… Country code selection\nâœ… Enhanced interface";
                alert(msg);
                localStorage.setItem('z_welcome_shown', 'true');
            }
        }, 1000);
    };

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ§Øª ==============
    function switchLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('z_language', lang);
        
        // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.lang = lang;
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ©
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
        document.querySelectorAll('[data-ar], [data-en]').forEach(element => {
            element.textContent = element.getAttribute(`data-${lang}`);
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø§Ø¦Ø¨Ø©
        document.querySelectorAll('[data-ar-placeholder], [data-en-placeholder]').forEach(element => {
            element.placeholder = element.getAttribute(`data-${lang}-placeholder`) || '';
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¬Ù„
        const statusMsg = lang === 'ar' 
            ? "âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" 
            : "âœ… Language changed to English";
        document.getElementById('statusLog').textContent = statusMsg;
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        updateMessageCounter();
        validateAndCountNumbers();
    }

    // ============== Ù†Ø¸Ø§Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ==============
    function setupFileDrop() {
        const uploadArea = document.getElementById('uploadArea');
        
        // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥ÙÙ„Ø§Øª
        uploadArea.addEventListener('drop', handleDrop, false);
    }
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    function highlight() {
        document.getElementById('uploadArea').classList.add('dragover');
    }
    
    function unhighlight() {
        document.getElementById('uploadArea').classList.remove('dragover');
    }
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    }
    
    function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
    }
    
    function handleFiles(files) {
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (10MB ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
            if (file.size > 10 * 1024 * 1024) {
                const msg = currentLanguage === 'ar' 
                    ? `Ø§Ù„Ù…Ù„Ù ${file.name} ÙŠØªØ¬Ø§ÙˆØ² 10MB`
                    : `File ${file.name} exceeds 10MB`;
                alert(msg);
                continue;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            const validTypes = ['image/', 'video/', 'application/pdf', 'text/', 'application/msword', 'application/vnd.openxmlformats-officedocument.'];
            const isValid = validTypes.some(type => file.type.startsWith(type));
            
            if (!isValid) {
                const msg = currentLanguage === 'ar' 
                    ? `Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ${file.name} ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…`
                    : `File type ${file.name} is not supported`;
                alert(msg);
                continue;
            }
            
            uploadedFiles.push({
                name: file.name,
                size: formatFileSize(file.size),
                file: file,
                url: null
            });
        }
        
        renderFileList();
        updateFileLinks();
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function renderFileList() {
        const fileList = document.getElementById('fileList');
        const container = document.getElementById('uploadedFilesContainer');
        
        if (uploadedFiles.length === 0) {
            fileList.innerHTML = '';
            container.style.display = 'none';
            return;
        }
        
        container.style.display = 'block';
        
        fileList.innerHTML = uploadedFiles.map((file, index) => `
            <div class="file-item">
                <div class="file-info">
                    <div class="file-icon">${getFileIcon(file.name)}</div>
                    <div>
                        <div class="file-name" title="${file.name}">${file.name}</div>
                        <div class="file-size">${file.size}</div>
                    </div>
                </div>
                <div class="remove-file" onclick="removeFile(${index})">Ã—</div>
            </div>
        `).join('');
    }
    
    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(ext)) return 'ğŸ–¼ï¸';
        if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv'].includes(ext)) return 'ğŸ¥';
        if (['pdf'].includes(ext)) return 'ğŸ“„';
        if (['doc', 'docx'].includes(ext)) return 'ğŸ“';
        if (['xls', 'xlsx'].includes(ext)) return 'ğŸ“Š';
        if (['zip', 'rar', '7z'].includes(ext)) return 'ğŸ“¦';
        return 'ğŸ“';
    }
    
    function removeFile(index) {
        uploadedFiles.splice(index, 1);
        renderFileList();
        updateFileLinks();
        saveFiles();
        
        const msg = currentLanguage === 'ar' 
            ? "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù" 
            : "File removed";
        document.getElementById('statusLog').textContent = msg;
    }
    
    function saveFiles() {
        localStorage.setItem('z_files', JSON.stringify(uploadedFiles.map(f => ({
            name: f.name,
            size: f.size,
            url: f.url
        }))));
    }
    
    async function uploadFilesToCloud() {
        if (uploadedFiles.length === 0) {
            const msg = currentLanguage === 'ar' 
                ? "âš ï¸ Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª Ù„Ù„Ø±ÙØ¹" 
                : "âš ï¸ No files selected for upload";
            alert(msg);
            return;
        }
        
        const progressBar = document.getElementById('uploadProgressBar');
        const progressContainer = document.getElementById('uploadProgress');
        progressContainer.style.display = 'block';
        
        const msg = currentLanguage === 'ar' 
            ? "â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©..." 
            : "â³ Uploading files to cloud...";
        document.getElementById('statusLog').textContent = msg;
        
        try {
            // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… API Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            // Ù„Ù„ØªÙˆØ¶ÙŠØ­ØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ø© File.io Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
            for (let i = 0; i < uploadedFiles.length; i++) {
                const file = uploadedFiles[i];
                progressBar.style.width = `${((i + 1) / uploadedFiles.length) * 100}%`;
                
                if (!file.url) {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ API Ø­Ù‚ÙŠÙ‚ÙŠ)
                    await simulateUpload(file);
                    
                    // Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORSØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø±ÙˆØ§Ø¨Ø· ÙˆÙ‡Ù…ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„
                    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù…:
                    // const formData = new FormData();
                    // formData.append('file', file.file);
                    // const response = await fetch('https://file.io', { method: 'POST', body: formData });
                    // const data = await response.json();
                    // file.url = data.link;
                    
                    file.url = `https://example.com/uploads/${Date.now()}_${file.name}`;
                }
            }
            
            updateFileLinks();
            saveFiles();
            
            const successMsg = currentLanguage === 'ar' 
                ? `âœ… ØªÙ… Ø±ÙØ¹ ${uploadedFiles.length} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­` 
                : `âœ… Successfully uploaded ${uploadedFiles.length} files`;
            document.getElementById('statusLog').textContent = successMsg;
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
                progressBar.style.width = '0%';
            }, 2000);
            
        } catch (error) {
            console.error('Upload error:', error);
            const errorMsg = currentLanguage === 'ar' 
                ? "âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª" 
                : "âŒ Failed to upload files. Check your internet connection";
            document.getElementById('statusLog').textContent = errorMsg;
            progressContainer.style.display = 'none';
        }
    }
    
    function simulateUpload(file) {
        return new Promise(resolve => {
            setTimeout(() => resolve(), 1000);
        });
    }
    
    function updateFileLinks() {
        const uploadedFilesUrl = document.getElementById('uploadedFilesUrl');
        const manualFileUrl = document.getElementById('manualFileUrl').value;
        
        let allLinks = [];
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        uploadedFiles.forEach(file => {
            if (file.url) {
                allLinks.push(file.url);
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠØ¯ÙˆÙŠ
        if (manualFileUrl) {
            allLinks.push(manualFileUrl);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚Ù„
        uploadedFilesUrl.value = allLinks.join('\n');
        
        // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠØ¯ÙˆÙŠ
        localStorage.setItem('z_manual_file', manualFileUrl);
    }

    // ============== Ø¥Ø¯Ø§Ø±Ø© ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© ==============
    function updateCountryCode() {
        const select = document.getElementById('countryCode');
        const customInput = document.getElementById('customCountryCode');
        
        if (select.value === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
            localStorage.setItem('z_country_code', select.value);
        }
    }
    
    function getCountryCode() {
        const select = document.getElementById('countryCode');
        if (select.value === 'custom') {
            return document.getElementById('customCountryCode').value || '+966';
        }
        return select.value;
    }

    // ============== Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==============
    function updateMessageCounter() {
        const message = document.getElementById('mainMessage').value;
        const chars = message.length;
        const words = message.trim() ? message.trim().split(/\s+/).length : 0;
        
        document.getElementById('messageCounter').textContent = chars;
        
        const charText = currentLanguage === 'ar' ? `${chars} Ø­Ø±Ù` : `${chars} chars`;
        const wordText = currentLanguage === 'ar' ? `${words} ÙƒÙ„Ù…Ø©` : `${words} words`;
        
        document.getElementById('charCount').textContent = charText;
        document.getElementById('wordCount').textContent = wordText;
    }
    
    function validateAndCountNumbers() {
        const numbersText = document.getElementById('phoneNumbers').value;
        const numbersArray = numbersText.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        document.getElementById('numbersCounter').textContent = numbersArray.length;
        
        let validCount = 0;
        let invalidCount = 0;
        
        numbersArray.forEach(num => {
            if (isValidPhoneNumber(num)) {
                validCount++;
            } else {
                invalidCount++;
            }
        });
        
        const validText = currentLanguage === 'ar' ? `${validCount} Ø±Ù‚Ù… ØµØ§Ù„Ø­` : `${validCount} valid`;
        const invalidText = currentLanguage === 'ar' ? `${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­` : `${invalidCount} invalid`;
        
        document.getElementById('validNumbers').textContent = validText;
        document.getElementById('invalidNumbers').textContent = invalidText;
        
        const counter = document.getElementById('numbersCounter');
        if (invalidCount > 0) {
            counter.style.background = 'var(--error)';
        } else {
            counter.style.background = 'var(--success)';
        }
    }
    
    function isValidPhoneNumber(phone) {
        const cleanNum = phone.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
        const patterns = [
            /^\+[1-9]\d{10,14}$/,
            /^00[1-9]\d{10,14}$/,
            /^[1-9]\d{9,14}$/
        ];
        return patterns.some(pattern => pattern.test(cleanNum));
    }
    
    function cleanPhoneNumbers(numbers) {
        const countryCode = getCountryCode();
        
        return numbers.map(num => {
            let cleanNum = num.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
            
            if (cleanNum.startsWith('00')) {
                cleanNum = '+' + cleanNum.substring(2);
            } else if (/^[0-9]{9,}$/.test(cleanNum) && !cleanNum.startsWith('+')) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø£Ø¶Ù ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø©
                if (cleanNum.startsWith('0')) {
                    cleanNum = countryCode + cleanNum.substring(1);
                } else {
                    cleanNum = countryCode + cleanNum;
                }
            }
            
            return cleanNum;
        }).filter(isValidPhoneNumber);
    }

    // ============== ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ==============
    function addCurrentLocation() {
        const log = document.getElementById('statusLog');
        
        if (!navigator.geolocation) {
            const msg = currentLanguage === 'ar' 
                ? "Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹" 
                : "Your browser doesn't support geolocation";
            alert(msg);
            return;
        }

        const loadingMsg = currentLanguage === 'ar' 
            ? "ğŸ›°ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ..." 
            : "ğŸ›°ï¸ Getting your location...";
        log.textContent = loadingMsg;

        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude.toFixed(6);
                const lng = position.coords.longitude.toFixed(6);
                const accuracy = Math.round(position.coords.accuracy);
                
                const locationText = currentLanguage === 'ar' 
                    ? `ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:\nØ¯Ù‚Ø©: ${accuracy} Ù…ØªØ±\nhttps://maps.google.com/?q=${lat},${lng}`
                    : `ğŸ“ My Current Location:\nAccuracy: ${accuracy} meters\nhttps://maps.google.com/?q=${lat},${lng}`;
                
                const textarea = document.getElementById('mainMessage');
                if (textarea.value && !textarea.value.endsWith('\n')) {
                    textarea.value += '\n\n';
                }
                textarea.value += locationText;
                
                const successMsg = currentLanguage === 'ar' 
                    ? "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹" 
                    : "âœ… Location added";
                log.textContent = successMsg;
                
                updateMessageCounter();
            },
            (error) => {
                const errorMsg = currentLanguage === 'ar' 
                    ? "âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ GPS" 
                    : "âŒ Failed to get location. Make sure GPS is enabled";
                log.textContent = errorMsg;
            },
            { enableHighAccuracy: true, timeout: 10000 }
        );
    }

    // ============== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© ==============
    function showPreview() {
        updateFileLinks();
        const message = document.getElementById('mainMessage').value;
        const uploadedFilesUrl = document.getElementById('uploadedFilesUrl').value;
        const preview = document.getElementById('messagePreview');
        
        if (!message && !uploadedFilesUrl) {
            const noPreviewMsg = currentLanguage === 'ar' 
                ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©" 
                : "No message to preview";
            preview.innerHTML = `<em style='color: #999;'>${noPreviewMsg}</em>`;
            preview.style.display = 'block';
            return;
        }
        
        let previewHTML = '';
        
        if (message) {
            const msgTitle = currentLanguage === 'ar' ? "ğŸ“ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:" : "ğŸ“ Message Text:";
            previewHTML += `<div style="margin-bottom: 15px;"><strong>${msgTitle}</strong></div>`;
            previewHTML += `<div style="white-space: pre-wrap; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">${message.replace(/\n/g, '<br>')}</div>`;
        }
        
        if (uploadedFilesUrl) {
            const filesTitle = currentLanguage === 'ar' ? "ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:" : "ğŸ“ Attached Files:";
            previewHTML += `<div style="margin-bottom: 10px;"><strong>${filesTitle}</strong></div>`;
            previewHTML += `<div style="color: #3498db; word-break: break-all; font-size: 13px;">${uploadedFilesUrl.replace(/\n/g, '<br>')}</div>`;
        }
        
        preview.innerHTML = previewHTML;
        preview.style.display = 'block';
        
        setTimeout(() => {
            preview.style.opacity = '0';
            preview.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                preview.style.display = 'none';
                preview.style.opacity = '1';
            }, 500);
        }, 8000);
    }

    // ============== Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© ==============
    function startCampaign() {
        const rawNums = document.getElementById('phoneNumbers').value;
        const numbersArray = rawNums.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        if (numbersArray.length === 0) {
            const msg = currentLanguage === 'ar' 
                ? "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹" 
                : "âš ï¸ Please enter numbers first";
            alert(msg);
            return;
        }
        
        contacts = cleanPhoneNumbers(numbersArray);
        
        if (contacts.length === 0) {
            const msg = currentLanguage === 'ar' 
                ? "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ØµØ§Ù„Ø­Ø©" 
                : "âŒ No valid numbers found";
            alert(msg);
            return;
        }
        
        if (contacts.length < numbersArray.length) {
            const invalidCount = numbersArray.length - contacts.length;
            const confirmMsg = currentLanguage === 'ar' 
                ? `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ ${contacts.length} Ø±Ù‚Ù… ØµØ§Ù„Ø­ ÙÙ‚Ø·ØŸ`
                : `Found ${invalidCount} invalid numbers.\nContinue with ${contacts.length} valid numbers only?`;
            if (!confirm(confirmMsg)) return;
        }
        
        if (contacts.length > 50) {
            const warningMsg = currentLanguage === 'ar' 
                ? `ØªØ­Ø°ÙŠØ±: Ø³ØªØ±Ø³Ù„ ${contacts.length} Ø±Ø³Ø§Ù„Ø©.\nÙ‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø­Ø¸Ø± Ù…Ù† WhatsApp.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`
                : `Warning: You'll send ${contacts.length} messages.\nThis may cause WhatsApp restrictions.\nContinue?`;
            if (!confirm(warningMsg)) return;
        }
        
        const finalConfirm = currentLanguage === 'ar' 
            ? `ğŸš€ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„!\n\nØ¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${contacts.length}\nØ³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù„ÙƒÙ„ Ø±Ù‚Ù….\nØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¢Ù†ØŸ`
            : `ğŸš€ Ready to send!\n\nMessages: ${contacts.length}\nA window will open for each number.\nMake sure to allow popups.\n\nStart now?`;
        
        if (!confirm(finalConfirm)) return;
        
        totalContacts = contacts.length;
        currentIdx = 0;
        
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('progressContainer').style.display = 'block';
        
        const startMsg = currentLanguage === 'ar' 
            ? `ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ${totalContacts} Ø±Ù‚Ù…...` 
            : `ğŸš€ Starting sending to ${totalContacts} numbers...`;
        document.getElementById('statusLog').textContent = startMsg;
        
        processNext();
    }
    
    function processNext() {
        if (currentIdx >= totalContacts) {
            completeCampaign();
            return;
        }
        
        updateFileLinks();
        const phone = contacts[currentIdx];
        let finalMsg = document.getElementById('mainMessage').value;
        const fileLinks = document.getElementById('uploadedFilesUrl').value;
        
        if (fileLinks) {
            const filesTitle = currentLanguage === 'ar' ? "ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:" : "ğŸ“ Attached Files:";
            finalMsg += `\n\n${filesTitle}\n${fileLinks}`;
        }
        
        const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(finalMsg)}`;
        
        const statusMsg = currentLanguage === 'ar' 
            ? `ğŸ“¤ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ${currentIdx + 1} Ù…Ù† ${totalContacts}` 
            : `ğŸ“¤ Sending ${currentIdx + 1} of ${totalContacts}`;
        document.getElementById('statusLog').innerHTML = `${statusMsg}<br><small>${phone}</small>`;
        
        updateProgress();
        
        setTimeout(() => {
            window.open(whatsappUrl, '_blank', 'width=600,height=700');
        }, 500);
        
        currentIdx++;
        
        if (currentIdx < totalContacts) {
            const nextText = currentLanguage === 'ar' 
                ? `â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ (${currentIdx + 1} Ù…Ù† ${totalContacts})` 
                : `â¡ï¸ Next (${currentIdx + 1} of ${totalContacts})`;
            document.getElementById('nextBtn').innerHTML = `<span class="icon">â¡ï¸</span> <span>${nextText}</span>`;
        } else {
            const completeText = currentLanguage === 'ar' ? 'âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' : 'âœ… Sending Complete';
            document.getElementById('nextBtn').innerHTML = `<span class="icon">âœ…</span> <span>${completeText}</span>`;
        }
    }
    
    function updateProgress() {
        const progress = totalContacts > 0 ? ((currentIdx / totalContacts) * 100) : 0;
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        progressFill.style.width = `${progress}%`;
        const progressMsg = currentLanguage === 'ar' 
            ? `${Math.round(progress)}% (${currentIdx} Ù…Ù† ${totalContacts})` 
            : `${Math.round(progress)}% (${currentIdx} of ${totalContacts})`;
        progressText.textContent = progressMsg;
    }
    
    function completeCampaign() {
        const completeMsg = currentLanguage === 'ar' 
            ? `ğŸ‰ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!\n<small>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${totalContacts} Ø±Ø³Ø§Ù„Ø©</small>` 
            : `ğŸ‰ Campaign completed successfully!\n<small>Sent ${totalContacts} messages</small>`;
        document.getElementById('statusLog').innerHTML = completeMsg;
        
        const newCampaignText = currentLanguage === 'ar' ? 'ğŸ”„ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'ğŸ”„ New Campaign';
        document.getElementById('nextBtn').innerHTML = `<span class="icon">ğŸ”„</span> <span>${newCampaignText}</span>`;
        document.getElementById('nextBtn').onclick = () => location.reload();
        
        document.getElementById('progressFill').style.background = 'var(--success)';
        localStorage.setItem('z_last_send', new Date().toISOString());
    }

    // ============== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ==============
    function saveData() {
        const message = document.getElementById('mainMessage').value;
        const numbers = document.getElementById('phoneNumbers').value;
        const manualFileUrl = document.getElementById('manualFileUrl').value;
        const countryCode = document.getElementById('countryCode').value;
        
        localStorage.setItem('z_msg', message);
        localStorage.setItem('z_nums', numbers);
        localStorage.setItem('z_manual_file', manualFileUrl);
        localStorage.setItem('z_country_code', countryCode);
        saveFiles();
        
        const saveMsg = currentLanguage === 'ar' 
            ? "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­" 
            : "âœ… Data saved successfully";
        document.getElementById('statusLog').textContent = saveMsg;
        
        const log = document.getElementById('statusLog');
        log.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
        setTimeout(() => {
            log.style.background = '';
        }, 2000);
    }
    
    function resetAll() {
        const confirmMsg = currentLanguage === 'ar' 
            ? "âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ" 
            : "âš ï¸ Delete all data?";
        
        if (confirm(confirmMsg)) {
            localStorage.clear();
            location.reload();
        }
    }

    // ============== Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ==============
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            saveData();
        }
        
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            if (document.getElementById('startBtn').style.display !== 'none') {
                startCampaign();
            }
        }
        
        if (e.key === 'F1') {
            e.preventDefault();
            const helpMsg = currentLanguage === 'ar' 
                ? `ğŸ†˜ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­:\n\nCtrl+S: Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nCtrl+Enter: Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©\nF1: Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©\n\nØªØ·ÙˆÙŠØ±: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯`
                : `ğŸ†˜ Keyboard Shortcuts:\n\nCtrl+S: Save data\nCtrl+Enter: Start campaign\nF1: This help\n\nDeveloper: Mohammed Ahmed`;
            alert(helpMsg);
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¨Ù€ Ctrl+L
        if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
            e.preventDefault();
            const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
            switchLanguage(newLang);
        }
    });
</script>

</body>
</html>
