<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ - Ø¨ÙˆØ§Ø³Ø·Ø©: Ø¯. Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.github.io https://*.githubusercontent.com https://maps.google.com https://www.google.com https://api.whatsapp.com https://wa.me blob:; media-src 'self' blob:;">
    
    <style>
        /* Ø¬Ù…ÙŠØ¹ Ø£Ù†Ù…Ø§Ø· CSS Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù‡Ù†Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
        :root { 
            --wa-green: #25D366; 
            --wa-dark: #075E54; 
            --error: #e74c3c; 
            --success: #2ecc71; 
            --primary: #3498db;
            --warning: #f1c40f;
            --gray: #95a5a6;
            --purple: #9b59b6;
            --pink: #e84393;
            --teal: #00cec9;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #f0f2f5 0%, #dfe6e9 100%);
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center;
            min-height: 100vh;
        }
        
        .app-container { 
            background: white; 
            width: 100%; 
            max-width: 750px; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            margin: auto;
        }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
        /* ... */
    </style>
</head>
<body>

<div class="app-container">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="control-bar">
        <div class="developer-info">
            <div class="dev-badge">
                <span>ğŸ‘¨â€âš•ï¸</span>
                <span data-ar="Ø¯. Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ" data-en="Dr. Mohammed Mohammed Ali">Ø¯. Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</span>
                <div class="dev-degree">PhD</div>
            </div>
        </div>
        
        <div class="language-switcher">
            <button class="lang-btn active" onclick="switchLanguage('ar')">
                <span>ğŸ‡¸ğŸ‡¦</span>
                <span data-ar="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" data-en="Arabic">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
            </button>
            <button class="lang-btn" onclick="switchLanguage('en')">
                <span>ğŸ‡ºğŸ‡¸</span>
                <span data-ar="Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©" data-en="English">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</span>
            </button>
        </div>
    </div>

    <h2>
        <span class="icon">ğŸš€</span>
        <span data-ar="Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…" data-en="Zajel Pro Advanced">Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</span>
        <small style="font-size: 14px; color: #666; display: block; margin-top: 5px;">
            <span data-ar="(Ù†Ø³Ø®Ø© GitHub Pages - Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø·)" 
                  data-en="(GitHub Pages Edition - Basic Features Only)">
                (Ù†Ø³Ø®Ø© GitHub Pages - Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø·)
            </span>
        </small>
    </h2>

    <div class="alert alert-warning" id="alertBox">
        <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø© Ø­ÙˆÙ„ GitHub Pages:</strong><br><br>
        <span>Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ GitHub Pages Ù…Ø¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø·.<br>
        Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠØŒ ÙƒØ§Ù…ÙŠØ±Ø§ØŒ GPS) ØªØ­ØªØ§Ø¬ HTTPS ÙƒØ§Ù…Ù„.<br>
        Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§ØªØŒ Ø§Ø³ØªØ®Ø¯Ù… <a href="https://netlify.com" target="_blank">Netlify</a>.</span>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù -->
    <div class="functions-tabs">
        <button class="tab-btn active" onclick="switchFunction('text')">
            <span class="icon">ğŸ“</span>
            <span data-ar="Ù†Øµ ÙˆÙ…Ù„ÙØ§Øª" data-en="Text & Files">Ù†Øµ ÙˆÙ…Ù„ÙØ§Øª</span>
        </button>
        <button class="tab-btn" onclick="switchFunction('upload')">
            <span class="icon">ğŸ“</span>
            <span data-ar="Ø±ÙØ¹ Ù…Ù„ÙØ§Øª" data-en="Upload Files">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª</span>
        </button>
        <button class="tab-btn" onclick="showAdvancedFeaturesAlert()">
            <span class="icon">ğŸ¤</span>
            <span data-ar="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ" data-en="Voice Record">ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</span>
        </button>
        <button class="tab-btn" onclick="showAdvancedFeaturesAlert()">
            <span class="icon">ğŸ“·</span>
            <span data-ar="ÙƒØ§Ù…ÙŠØ±Ø§" data-en="Camera">ÙƒØ§Ù…ÙŠØ±Ø§</span>
        </button>
        <button class="tab-btn" onclick="switchFunction('location')">
            <span class="icon">ğŸ“</span>
            <span data-ar="Ø§Ù„Ù…ÙˆÙ‚Ø¹" data-en="Location">Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
        </button>
    </div>

    <!-- Ù…Ø­ØªÙˆÙ‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Øµ -->
    <div class="function-content active" id="textFunction">
        <div class="box">
            <label data-ar="1. Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:" data-en="1. Unified Message Text:">
                <span>1. Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:</span>
                <span id="messageCounter" class="counter">0</span>
            </label>
            <textarea id="mainMessage" rows="4" 
                      data-ar-placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." 
                      data-en-placeholder="Type your message here..."
                      oninput="updateMessageCounter()"></textarea>
            
            <div class="stats">
                <span id="charCount" data-ar="0 Ø­Ø±Ù" data-en="0 chars">0 Ø­Ø±Ù</span>
                <span id="wordCount" data-ar="0 ÙƒÙ„Ù…Ø©" data-en="0 words">0 ÙƒÙ„Ù…Ø©</span>
            </div>
            
            <!-- Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…Ù„ÙØ§Øª -->
            <div class="input-with-icon" style="margin-top: 15px;">
                <input type="text" id="manualFileUrl" 
                       data-ar-placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù…Ù„Ù (ØµÙˆØ±ØŒ ÙÙŠØ¯ÙŠÙˆØŒ PDF)..."
                       data-en-placeholder="Enter file link (images, video, PDF)...">
                <span class="input-icon">ğŸ”—</span>
            </div>
            
            <button class="btn" style="background: #1abc9c; color: white; margin-top: 10px;" onclick="showPreview()">
                <span class="icon">ğŸ‘ï¸</span>
                <span data-ar="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©" data-en="Preview Message">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</span>
            </button>
            
            <div id="messagePreview" class="message-preview"></div>
        </div>
    </div>

    <!-- Ù…Ø­ØªÙˆÙ‰ ØªØ¨ÙˆÙŠØ¨ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <div class="function-content" id="uploadFunction">
        <div class="box">
            <label data-ar="ğŸ“ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ" data-en="ğŸ“ Upload Files from Device">
                ğŸ“ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ
            </label>
            
            <div class="upload-section" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="icon">ğŸ“</div>
                <div data-ar="Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ" 
                     data-en="Click to select files from your device">
                    Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    <span data-ar="(Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ PDFØŒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)" 
                          data-en="(Images, Videos, PDF, Documents)">
                        (Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ PDFØŒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)
                    </span>
                </div>
                <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© -->
            <div class="file-list" id="fileList"></div>
            
            <div style="margin-top: 15px; font-size: 14px; color: #666;">
                <div>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ù„ÙØ§Øª ØªØ­ÙØ¸ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·</div>
                <div>Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… <a href="https://imgbb.com" target="_blank">ImgBB</a> Ø£Ùˆ <a href="https://wetransfer.com" target="_blank">WeTransfer</a></div>
            </div>
        </div>
    </div>

    <!-- Ù…Ø­ØªÙˆÙ‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
    <div class="function-content" id="locationFunction">
        <div class="box">
            <label data-ar="ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ" data-en="ğŸ“ Geolocation">
                ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
            </label>
            
            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px;">
                <strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ø­ÙˆÙ„ GPS:</strong><br>
                Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ GPS Ø¹Ù„Ù‰ GitHub Pages:
                <ol style="margin: 10px 0; padding-right: 20px;">
                    <li>Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Live Server ÙÙŠ VS Code</li>
                    <li>Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… <a href="https://netlify.com" target="_blank">Netlify</a> Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ HTTPS ÙƒØ§Ù…Ù„</li>
                    <li>Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹</li>
                </ol>
            </div>
            
            <div class="input-with-icon">
                <input type="text" id="manualLocation" 
                       data-ar-placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ ÙŠØ¯ÙˆÙŠØ§Ù‹..."
                       data-en-placeholder="Enter Google Maps link manually...">
                <span class="input-icon">ğŸ“</span>
            </div>
            
            <button class="btn btn-gps" onclick="addManualLocation()" style="margin-top: 10px;">
                <span class="icon">ğŸ“</span>
                <span data-ar="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹" data-en="Add Location Manually">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹</span>
            </button>
            
            <button class="btn" onclick="tryGeolocation()" style="margin-top: 10px; background: #9b59b6; color: white;">
                <span class="icon">ğŸ”„</span>
                <span data-ar="Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹" data-en="Try Geolocation">Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
            </button>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
    <div class="box">
        <label data-ar="ğŸ“± Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:" data-en="ğŸ“± WhatsApp Numbers List:">
            <span>ğŸ“± Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</span>
            <span id="numbersCounter" class="counter">0</span>
        </label>
        <textarea id="phoneNumbers" rows="5" 
                  data-ar-placeholder="Ø¶Ø¹ ÙƒÙ„ Ø±Ù‚Ù… ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: +9665xxxxxxxx Ø£Ùˆ 9665xxxxxxxx)"
                  data-en-placeholder="Put each number on a new line (e.g., +9665xxxxxxxx or 9665xxxxxxxx)"
                  oninput="validateAndCountNumbers()"></textarea>
        
        <div class="stats">
            <span id="validNumbers" data-ar="0 Ø±Ù‚Ù… ØµØ§Ù„Ø­" data-en="0 valid numbers">0 Ø±Ù‚Ù… ØµØ§Ù„Ø­</span>
            <span id="invalidNumbers" data-ar="0 Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­" data-en="0 invalid numbers">0 Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
        
        <!-- Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© -->
        <div style="margin-top: 15px;">
            <label data-ar="Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:" data-en="Select default country code:">
                Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:
            </label>
            <select id="countryCode" onchange="updateCountryCode()">
                <option value="+966">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (+966)</option>
                <option value="+971">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª (+971)</option>
                <option value="+20">ğŸ‡ªğŸ‡¬ Ù…ØµØ± (+20)</option>
                <option value="+1">ğŸ‡ºğŸ‡¸ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© (+1)</option>
                <option value="+44">ğŸ‡¬ğŸ‡§ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø© (+44)</option>
                <option value="+962">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù† (+962)</option>
                <option value="custom">âœï¸ Ù…Ø®ØµØµ</option>
            </select>
            <input type="text" id="customCountryCode" placeholder="+xxx" style="display: none; margin-top: 10px;">
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
    </div>

    <div id="statusLog" data-ar="ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…" 
                      data-en="ğŸ“± Ready to start - Enter message and numbers">
        ğŸ“± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ - Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…
    </div>
    
    <button class="btn btn-send" id="startBtn" onclick="startCampaign()">
        <span class="icon">ğŸš€</span>
        <span data-ar="Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©" data-en="Start Mass Campaign">Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</span>
    </button>
    
    <button class="btn btn-next" id="nextBtn" onclick="processNext()">
        <span class="icon">â¡ï¸</span>
        <span data-ar="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ" data-en="Next Number">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ</span>
    </button>
    
    <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button class="btn btn-save" onclick="saveData()" style="flex: 1;">
            <span class="icon">ğŸ’¾</span>
            <span data-ar="Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©" data-en="Save Draft">Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©</span>
        </button>
        
        <button class="btn" style="background: #e74c3c; color: white; flex: 1;" onclick="resetAll()">
            <span class="icon">ğŸ”„</span>
            <span data-ar="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†" data-en="Reset All">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
        </button>
    </div>
</div>

<script>
    // ============== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ==============
    let contacts = [];
    let currentIdx = 0;
    let totalContacts = 0;
    let uploadedFiles = [];
    let currentLanguage = 'ar';
    let currentFunction = 'text';
    
    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ§Øª ==============
    function switchLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('z_language', lang);
        
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.lang = lang;
        
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        updateAllTexts();
        
        const statusMsg = lang === 'ar' 
            ? "âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" 
            : "âœ… Language changed to English";
        document.getElementById('statusLog').textContent = statusMsg;
        
        updateMessageCounter();
        validateAndCountNumbers();
    }
    
    function updateAllTexts() {
        document.querySelectorAll('[data-ar], [data-en]').forEach(element => {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                const placeholder = element.getAttribute(`data-${currentLanguage}-placeholder`);
                if (placeholder) element.placeholder = placeholder;
            } else {
                const text = element.getAttribute(`data-${currentLanguage}`);
                if (text) element.textContent = text;
            }
        });
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ==============
    function switchFunction(func) {
        currentFunction = func;
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        document.querySelectorAll('.function-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${func}Function`).classList.add('active');
    }
    
    function showAdvancedFeaturesAlert() {
        const msg = currentLanguage === 'ar' 
            ? "âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ØªØ­ØªØ§Ø¬ HTTPS ÙƒØ§Ù…Ù„.\n\nÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:\n1. Ø§Ø³ØªØ®Ø¯Ù… Live Server ÙÙŠ VS Code\n2. Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Netlify Ù„Ù„Ù†Ø´Ø±\n3. Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ø© HTTPS Ø£Ø®Ø±Ù‰"
            : "âš ï¸ This feature requires full HTTPS.\n\nFor all features:\n1. Use Live Server in VS Code\n2. Or deploy on Netlify\n3. Or use another HTTPS service";
        alert(msg);
    }

    // ============== Ù†Ø¸Ø§Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠ ==============
    function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
    }
    
    function handleFiles(files) {
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            
            if (file.size > 10 * 1024 * 1024) {
                const msg = currentLanguage === 'ar' 
                    ? `Ø§Ù„Ù…Ù„Ù ${file.name} ÙŠØªØ¬Ø§ÙˆØ² 10MB`
                    : `File ${file.name} exceeds 10MB`;
                alert(msg);
                continue;
            }
            
            const validTypes = ['image/', 'video/', 'application/pdf', 'text/', 'application/msword', 'application/vnd.openxmlformats-officedocument.'];
            const isValid = validTypes.some(type => file.type.startsWith(type));
            
            if (!isValid) {
                const msg = currentLanguage === 'ar' 
                    ? `Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ${file.name} ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…`
                    : `File type ${file.name} is not supported`;
                alert(msg);
                continue;
            }
            
            const fileURL = URL.createObjectURL(file);
            uploadedFiles.push({
                name: file.name,
                size: formatFileSize(file.size),
                url: fileURL,
                type: file.type
            });
        }
        
        renderFileList();
        updateFileLinks();
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function renderFileList() {
        const fileList = document.getElementById('fileList');
        
        if (uploadedFiles.length === 0) {
            fileList.innerHTML = '';
            return;
        }
        
        fileList.innerHTML = uploadedFiles.map((file, index) => `
            <div class="file-item">
                <div class="file-info">
                    <div class="file-icon">${getFileIcon(file.name)}</div>
                    <div>
                        <div class="file-name" title="${file.name}">${file.name}</div>
                        <div class="file-size">${file.size}</div>
                    </div>
                </div>
                <div class="remove-file" onclick="removeFile(${index})">Ã—</div>
            </div>
        `).join('');
    }
    
    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(ext)) return 'ğŸ–¼ï¸';
        if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv'].includes(ext)) return 'ğŸ¥';
        if (['pdf'].includes(ext)) return 'ğŸ“„';
        if (['doc', 'docx'].includes(ext)) return 'ğŸ“';
        return 'ğŸ“';
    }
    
    function removeFile(index) {
        // ØªØ­Ø±ÙŠØ± URL Ù„Ù„Ø°Ø§ÙƒØ±Ø©
        if (uploadedFiles[index].url) {
            URL.revokeObjectURL(uploadedFiles[index].url);
        }
        uploadedFiles.splice(index, 1);
        renderFileList();
        updateFileLinks();
        
        const msg = currentLanguage === 'ar' 
            ? "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù" 
            : "File removed";
        document.getElementById('statusLog').textContent = msg;
    }
    
    function updateFileLinks() {
        const manualFileUrl = document.getElementById('manualFileUrl').value;
        let allLinks = [];
        
        uploadedFiles.forEach(file => {
            if (file.url) {
                allLinks.push(file.url);
            }
        });
        
        if (manualFileUrl) {
            allLinks.push(manualFileUrl);
        }
        
        return allLinks.join('\n');
    }

    // ============== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ ==============
    function addManualLocation() {
        const manualLocation = document.getElementById('manualLocation').value;
        if (!manualLocation) {
            const msg = currentLanguage === 'ar' 
                ? "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹" 
                : "âš ï¸ Please enter location link first";
            alert(msg);
            return;
        }
        
        const textarea = document.getElementById('mainMessage');
        const locationText = currentLanguage === 'ar' 
            ? `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:\n${manualLocation}`
            : `ğŸ“ Location:\n${manualLocation}`;
        
        if (textarea.value && !textarea.value.endsWith('\n')) {
            textarea.value += '\n\n';
        }
        textarea.value += locationText;
        
        updateMessageCounter();
        
        const msg = currentLanguage === 'ar' 
            ? "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹" 
            : "âœ… Location added manually";
        document.getElementById('statusLog').textContent = msg;
    }
    
    function tryGeolocation() {
        if (!navigator.geolocation) {
            const msg = currentLanguage === 'ar' 
                ? "âŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹" 
                : "âŒ Your browser doesn't support geolocation";
            alert(msg);
            return;
        }
        
        const log = document.getElementById('statusLog');
        const loadingMsg = currentLanguage === 'ar' 
            ? "ğŸ›°ï¸ Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹..." 
            : "ğŸ›°ï¸ Trying to get location...";
        log.textContent = loadingMsg;
        
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude.toFixed(6);
                const lng = position.coords.longitude.toFixed(6);
                const googleMaps = `https://maps.google.com/?q=${lat},${lng}`;
                
                document.getElementById('manualLocation').value = googleMaps;
                
                const successMsg = currentLanguage === 'ar' 
                    ? "ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­" 
                    : "ğŸ“ Location determined successfully";
                log.textContent = successMsg;
            },
            (error) => {
                console.error('Geolocation error:', error);
                const errorMsg = currentLanguage === 'ar' 
                    ? "âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS ÙƒØ§Ù…Ù„" 
                    : "âŒ Failed to get location. Try using full HTTPS";
                log.textContent = errorMsg;
                
                const helpMsg = currentLanguage === 'ar' 
                    ? "ğŸ’¡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ GPS:\n1. Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Live Server\n2. Ø£Ùˆ Ø§Ù†Ø´Ø± Ø¹Ù„Ù‰ Netlify\n3. Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹"
                    : "ğŸ’¡ For GPS access:\n1. Open with Live Server\n2. Or deploy on Netlify\n3. Or enter location manually";
                alert(helpMsg);
            },
            { enableHighAccuracy: true, timeout: 5000 }
        );
    }

    // ============== Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==============
    function updateMessageCounter() {
        const message = document.getElementById('mainMessage').value;
        const chars = message.length;
        const words = message.trim() ? message.trim().split(/\s+/).length : 0;
        
        document.getElementById('messageCounter').textContent = chars;
        
        const charText = currentLanguage === 'ar' ? `${chars} Ø­Ø±Ù` : `${chars} chars`;
        const wordText = currentLanguage === 'ar' ? `${words} ÙƒÙ„Ù…Ø©` : `${words} words`;
        
        document.getElementById('charCount').textContent = charText;
        document.getElementById('wordCount').textContent = wordText;
    }
    
    function validateAndCountNumbers() {
        const numbersText = document.getElementById('phoneNumbers').value;
        const numbersArray = numbersText.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        document.getElementById('numbersCounter').textContent = numbersArray.length;
        
        let validCount = 0;
        let invalidCount = 0;
        
        numbersArray.forEach(num => {
            if (isValidPhoneNumber(num)) {
                validCount++;
            } else {
                invalidCount++;
            }
        });
        
        const validText = currentLanguage === 'ar' ? `${validCount} Ø±Ù‚Ù… ØµØ§Ù„Ø­` : `${validCount} valid`;
        const invalidText = currentLanguage === 'ar' ? `${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­` : `${invalidCount} invalid`;
        
        document.getElementById('validNumbers').textContent = validText;
        document.getElementById('invalidNumbers').textContent = invalidText;
        
        const counter = document.getElementById('numbersCounter');
        if (invalidCount > 0) {
            counter.style.background = 'var(--error)';
        } else {
            counter.style.background = 'var(--success)';
        }
    }
    
    function isValidPhoneNumber(phone) {
        const cleanNum = phone.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
        const patterns = [
            /^\+[1-9]\d{10,14}$/,
            /^00[1-9]\d{10,14}$/,
            /^[1-9]\d{9,14}$/
        ];
        return patterns.some(pattern => pattern.test(cleanNum));
    }
    
    function cleanPhoneNumbers(numbers) {
        const countryCode = getCountryCode();
        
        return numbers.map(num => {
            let cleanNum = num.replace(/\s+/g, '').replace(/[^0-9+]/g, '');
            
            if (cleanNum.startsWith('00')) {
                cleanNum = '+' + cleanNum.substring(2);
            } else if (/^[0-9]{9,}$/.test(cleanNum) && !cleanNum.startsWith('+')) {
                if (cleanNum.startsWith('0')) {
                    cleanNum = countryCode + cleanNum.substring(1);
                } else {
                    cleanNum = countryCode + cleanNum;
                }
            }
            
            return cleanNum;
        }).filter(isValidPhoneNumber);
    }
    
    function getCountryCode() {
        const select = document.getElementById('countryCode');
        if (select.value === 'custom') {
            return document.getElementById('customCountryCode').value || '+966';
        }
        return select.value;
    }
    
    function updateCountryCode() {
        const select = document.getElementById('countryCode');
        const customInput = document.getElementById('customCountryCode');
        
        if (select.value === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
            localStorage.setItem('z_country_code', select.value);
        }
    }
    
    function showPreview() {
        const message = document.getElementById('mainMessage').value;
        const fileLinks = updateFileLinks();
        const preview = document.getElementById('messagePreview');
        
        if (!message && !fileLinks) {
            const noPreviewMsg = currentLanguage === 'ar' 
                ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©" 
                : "No message to preview";
            preview.innerHTML = `<em style='color: #999;'>${noPreviewMsg}</em>`;
            preview.style.display = 'block';
            return;
        }
        
        let previewHTML = '';
        
        if (message) {
            const msgTitle = currentLanguage === 'ar' ? "ğŸ“ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:" : "ğŸ“ Message Text:";
            previewHTML += `<div style="margin-bottom: 15px;"><strong>${msgTitle}</strong></div>`;
            previewHTML += `<div style="white-space: pre-wrap; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">${message.replace(/\n/g, '<br>')}</div>`;
        }
        
        if (fileLinks) {
            const filesTitle = currentLanguage === 'ar' ? "ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:" : "ğŸ“ Attached Files:";
            previewHTML += `<div style="margin-bottom: 10px;"><strong>${filesTitle}</strong></div>`;
            previewHTML += `<div style="color: #3498db; word-break: break-all; font-size: 13px;">${fileLinks.replace(/\n/g, '<br>')}</div>`;
        }
        
        preview.innerHTML = previewHTML;
        preview.style.display = 'block';
        
        setTimeout(() => {
            preview.style.opacity = '0';
            preview.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                preview.style.display = 'none';
                preview.style.opacity = '1';
            }, 500);
        }, 8000);
    }
    
    function startCampaign() {
        const rawNums = document.getElementById('phoneNumbers').value;
        const numbersArray = rawNums.split('\n').map(n => n.trim()).filter(n => n !== '');
        
        if (numbersArray.length === 0) {
            const msg = currentLanguage === 'ar' 
                ? "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹" 
                : "âš ï¸ Please enter numbers first";
            alert(msg);
            return;
        }
        
        contacts = cleanPhoneNumbers(numbersArray);
        
        if (contacts.length === 0) {
            const msg = currentLanguage === 'ar' 
                ? "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ØµØ§Ù„Ø­Ø©" 
                : "âŒ No valid numbers found";
            alert(msg);
            return;
        }
        
        if (contacts.length < numbersArray.length) {
            const invalidCount = numbersArray.length - contacts.length;
            const confirmMsg = currentLanguage === 'ar' 
                ? `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${invalidCount} Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ ${contacts.length} Ø±Ù‚Ù… ØµØ§Ù„Ø­ ÙÙ‚Ø·ØŸ`
                : `Found ${invalidCount} invalid numbers.\nContinue with ${contacts.length} valid numbers only?`;
            if (!confirm(confirmMsg)) return;
        }
        
        if (contacts.length > 50) {
            const warningMsg = currentLanguage === 'ar' 
                ? `ØªØ­Ø°ÙŠØ±: Ø³ØªØ±Ø³Ù„ ${contacts.length} Ø±Ø³Ø§Ù„Ø©.\nÙ‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø­Ø¸Ø± Ù…Ù† WhatsApp.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`
                : `Warning: You'll send ${contacts.length} messages.\nThis may cause WhatsApp restrictions.\nContinue?`;
            if (!confirm(warningMsg)) return;
        }
        
        const finalConfirm = currentLanguage === 'ar' 
            ? `ğŸš€ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„!\n\nØ¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${contacts.length}\nØ³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù„ÙƒÙ„ Ø±Ù‚Ù….\nØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¢Ù†ØŸ`
            : `ğŸš€ Ready to send!\n\nMessages: ${contacts.length}\nA window will open for each number.\nMake sure to allow popups.\n\nStart now?`;
        
        if (!confirm(finalConfirm)) return;
        
        totalContacts = contacts.length;
        currentIdx = 0;
        
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('progressContainer').style.display = 'block';
        
        const startMsg = currentLanguage === 'ar' 
            ? `ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ${totalContacts} Ø±Ù‚Ù…...` 
            : `ğŸš€ Starting sending to ${totalContacts} numbers...`;
        document.getElementById('statusLog').textContent = startMsg;
        
        processNext();
    }
    
    function processNext() {
        if (currentIdx >= totalContacts) {
            completeCampaign();
            return;
        }
        
        const phone = contacts[currentIdx];
        let finalMsg = document.getElementById('mainMessage').value;
        const fileLinks = updateFileLinks();
        
        if (fileLinks) {
            const filesTitle = currentLanguage === 'ar' ? "ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:" : "ğŸ“ Attached Files:";
            finalMsg += `\n\n${filesTitle}\n${fileLinks}`;
        }
        
        const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(finalMsg)}`;
        
        const statusMsg = currentLanguage === 'ar' 
            ? `ğŸ“¤ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ${currentIdx + 1} Ù…Ù† ${totalContacts}` 
            : `ğŸ“¤ Sending ${currentIdx + 1} of ${totalContacts}`;
        document.getElementById('statusLog').innerHTML = `${statusMsg}<br><small>${phone}</small>`;
        
        updateProgress();
        
        setTimeout(() => {
            const newWindow = window.open(whatsappUrl, '_blank', 'width=600,height=700');
            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                alert(currentLanguage === 'ar' 
                    ? "âš ï¸ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©! ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©."
                    : "âš ï¸ Popup blocked! Please allow popups.");
            }
        }, 500);
        
        currentIdx++;
        
        if (currentIdx < totalContacts) {
            const nextText = currentLanguage === 'ar' 
                ? `â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ (${currentIdx + 1} Ù…Ù† ${totalContacts})` 
                : `â¡ï¸ Next (${currentIdx + 1} of ${totalContacts})`;
            document.getElementById('nextBtn').innerHTML = `<span class="icon">â¡ï¸</span> <span>${nextText}</span>`;
        } else {
            const completeText = currentLanguage === 'ar' ? 'âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' : 'âœ… Sending Complete';
            document.getElementById('nextBtn').innerHTML = `<span class="icon">âœ…</span> <span>${completeText}</span>`;
        }
    }
    
    function updateProgress() {
        const progress = totalContacts > 0 ? ((currentIdx / totalContacts) * 100) : 0;
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        progressFill.style.width = `${progress}%`;
        const progressMsg = currentLanguage === 'ar' 
            ? `${Math.round(progress)}% (${currentIdx} Ù…Ù† ${totalContacts})` 
            : `${Math.round(progress)}% (${currentIdx} of ${totalContacts})`;
        progressText.textContent = progressMsg;
    }
    
    function completeCampaign() {
        const completeMsg = currentLanguage === 'ar' 
            ? `ğŸ‰ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!\n<small>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${totalContacts} Ø±Ø³Ø§Ù„Ø©</small>` 
            : `ğŸ‰ Campaign completed successfully!\n<small>Sent ${totalContacts} messages</small>`;
        document.getElementById('statusLog').innerHTML = completeMsg;
        
        const newCampaignText = currentLanguage === 'ar' ? 'ğŸ”„ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'ğŸ”„ New Campaign';
        document.getElementById('nextBtn').innerHTML = `<span class="icon">ğŸ”„</span> <span>${newCampaignText}</span>`;
        document.getElementById('nextBtn').onclick = () => location.reload();
        
        document.getElementById('progressFill').style.background = 'var(--success)';
        localStorage.setItem('z_last_send', new Date().toISOString());
    }
    
    function saveData() {
        const message = document.getElementById('mainMessage').value;
        const numbers = document.getElementById('phoneNumbers').value;
        const manualFileUrl = document.getElementById('manualFileUrl').value;
        const manualLocation = document.getElementById('manualLocation').value;
        const countryCode = document.getElementById('countryCode').value;
        
        localStorage.setItem('z_msg', message);
        localStorage.setItem('z_nums', numbers);
        localStorage.setItem('z_manual_file', manualFileUrl);
        localStorage.setItem('z_manual_location', manualLocation);
        localStorage.setItem('z_country_code', countryCode);
        
        const saveMsg = currentLanguage === 'ar' 
            ? "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­" 
            : "âœ… Data saved successfully";
        document.getElementById('statusLog').textContent = saveMsg;
        
        const log = document.getElementById('statusLog');
        log.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
        setTimeout(() => {
            log.style.background = '';
        }, 2000);
    }
    
    function resetAll() {
        const confirmMsg = currentLanguage === 'ar' 
            ? "âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ" 
            : "âš ï¸ Delete all data?";
        
        if (confirm(confirmMsg)) {
            // ØªØ­Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ URLs
            uploadedFiles.forEach(file => {
                if (file.url) {
                    URL.revokeObjectURL(file.url);
                }
            });
            
            localStorage.clear();
            location.reload();
        }
    }

    // ============== Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ==============
    window.onload = () => {
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„ØºØ©
        const savedLang = localStorage.getItem('z_language') || 'ar';
        switchLanguage(savedLang);
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('mainMessage').value = localStorage.getItem('z_msg') || '';
        document.getElementById('phoneNumbers').value = localStorage.getItem('z_nums') || '';
        document.getElementById('manualFileUrl').value = localStorage.getItem('z_manual_file') || '';
        document.getElementById('manualLocation').value = localStorage.getItem('z_manual_location') || '';
        document.getElementById('countryCode').value = localStorage.getItem('z_country_code') || '+966';
        
        updateMessageCounter();
        validateAndCountNumbers();
        updateCountryCode();
        
        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
        setTimeout(() => {
            if (!localStorage.getItem('z_welcome_shown')) {
                const msg = currentLanguage === 'ar' 
                    ? `ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø²Ø§Ø¬Ù„ Ø¨Ø±Ùˆ (Ù†Ø³Ø®Ø© GitHub Pages)!\n\nØ¨ÙˆØ§Ø³Ø·Ø©: Ø¯. Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ\n\nâš¡ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©:\nâœ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ù…Ø§Ø¹ÙŠØ©\nâœ… Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ§Ù‹\nâœ… Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„\nâœ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n\nâš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ­ØªØ§Ø¬ HTTPS ÙƒØ§Ù…Ù„`
                    : `ğŸ‰ Welcome to Zajel Pro (GitHub Pages Edition)!\n\nBy: Dr. Mohammed Mohammed Ali\n\nâš¡ Available Features:\nâœ… Mass messaging\nâœ… Local file upload\nâœ… Message preview\nâœ… Data saving\n\nâš ï¸ Note: Some features require full HTTPS`;
                alert(msg);
                localStorage.setItem('z_welcome_shown', 'true');
            }
        }, 1000);
    };

    // ============== Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ==============
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            saveData();
        }
        
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            if (document.getElementById('startBtn').style.display !== 'none') {
                startCampaign();
            }
        }
        
        if (e.key === 'F1') {
            e.preventDefault();
            const helpMsg = currentLanguage === 'ar' 
                ? `ğŸ†˜ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­:\n\nCtrl+S: Ø­ÙØ¸\nCtrl+Enter: Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©\nF1: Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©\n\nÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:\nØ§Ø³ØªØ®Ø¯Ù… Netlify Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† GitHub Pages`
                : `ğŸ†˜ Keyboard Shortcuts:\n\nCtrl+S: Save\nCtrl+Enter: Start campaign\nF1: This help\n\nFor all features:\nUse Netlify instead of GitHub Pages`;
            alert(helpMsg);
        }
        
        if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
            e.preventDefault();
            const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
            switchLanguage(newLang);
        }
    });

    // ============== Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© ==============
    window.addEventListener('beforeunload', () => {
        // ØªØ­Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ URLs
        uploadedFiles.forEach(file => {
            if (file.url) {
                URL.revokeObjectURL(file.url);
            }
        });
    });
</script>

</body>
</html>
